```go
// 查询任务
db.getSiblingDB("jarvis").getCollection("task").find({nodeID:"a44576e7d185c4efd36298c7f394d2b4"}).sort({createAt:-1}).limit(5)

db.getSiblingDB("jarvis").getCollection("nodeInit").find({_id:"a44576e7d185c4efd36298c7f394d2b4"}).limit(21)
// 查询节点动作
db.getSiblingDB("jarvis").getCollection("nodeEvent").find({nodeID:"a79541a8fc6e539fb2e09445496b4589"}).sort({createTime:-1}).limit(10)
db.getSiblingDB("jarvis").getCollection("nodeStaticInfo").find({_id:"2c0b4a3c4425c910f9ac48cd4ad929f2"}).limit(10)
db.getSiblingDB("jarvis").getCollection("nodeStaticInfo").find({business:"{ }"}).limit(501)

db.getSiblingDB("jarvis").getCollection("nodeStaticInfo").find({nominalInfo:""}).limit(501)

db.getSiblingDB("jarvis").getCollection("nodeStaticInfo").find({"sortTimes.boundTime":{$exists:false}}).count()


db.getSiblingDB("jarvis").getCollection("nodeStaticInfo").find({"createAt":{$exists:false},vendorID:389}).count()

db.getSiblingDB("jarvis").getCollection("nodeStaticInfo").find({nominalInfo:{$exists: false}}).limit(501)

db.getSiblingDB("jarvis").getCollection("customer").find({}).limit(21)


db.getSiblingDB("jarvis").getCollection("autoCheckList").find({}).sort({createAt:-1}).limit(21)

db.getSiblingDB("jarvis").getCollection("nodeNetBench").find({nodeId:"cdcf61da2070ba71600b4efeb3ab8d0a"}).sort({time:-1}).limit(3)


// nodeEvent
db.getSiblingDB("jarvis").getCollection("nodeEvent").find({nodeID:"e7de459324cbe1d86fa59080c19a7a14"}).sort({createTime:-1}).limit(501)


// nodeEarn

db.getSiblingDB("jarvis").getCollection("nodeEarn").find({nodeID:"b03632fa89bc2cd59800000000000001"}).sort({start: -1}).limit(10)
db.getSiblingDB("jarvis").getCollection("nodeEarn").find().sort({start: -1}).limit(10)


db.getSiblingDB("jarvis").getCollection("nodeEvent").find({nodeID:"8f5ce8ba6e1fcf060492debdc81c254e"}).sort({createTime:-1}).limit(10)

// nodeInfo  bae9e87cb5bbd10aae377b4f3914eb9d
db.getSiblingDB("jarvis").getCollection("nodeInfo").find({nodeId:"c3029911f873b79efb23688084423365"}).limit(10)

db.getSiblingDB("jarvis").getCollection("nodeInfo").find({"disks.items.parts.mountpoint":"/pcdn_data/pcdn_index_data"}).limit(10)


db.getSiblingDB("jarvis").getCollection("nodeEarnHistory").find({"nodeearn.nodeID":"75a93ce7e1d83c872c00000000000001"}).sort({createtime:-1}).limit(10)

// nodeHistory

db.getSiblingDB("jarvis").getCollection("nodeHistory").find({remark:"PCDN1919"}).sort({nodeID: 1}).limit(501)
db.getSiblingDB("jarvis").getCollection("nodeHistory").find({nodeID:{"$in":["2c0b4a3c4425c910f9ac48cd4ad929f2"]}}).sort({nodeId: 1}).limit(501)
db.getSiblingDB("jarvis").getCollection("nodeHistory").find({_id:"6333be0ab5f65d78131c06ee"}).limit(501)
db.getSiblingDB("jarvis").getCollection("nodeHistory").find({_id:ObjectId("6333c4fff424fbe441cfe1ef")}).limit(501)
// serviceTime
db.getSiblingDB("jarvis").getCollection("nodeHistory").find({nodeID:"8ab0f47365a6867717b39f1012de4143",afterStage:{"$in":["inService","repelled"]}}).sort({opTime: 1}).limit(10)

// 服务中转让
db.getSiblingDB("jarvis").getCollection("nodeHistory").find({transferInfo:{"$exists":true},beforeStage:"inService"}).sort({opTime: 1}).limit(10)


db.getSiblingDB("jarvis").getCollection("nodeStaticInfo").find({nominalInfo:{$exists: false},stage:"inService"}).sort({_id: 1}).limit(501)
db.getSiblingDB("jarvis").getCollection("nodeStaticInfo").find({"nominalInfo.webPort":{$exists: false},stage:"inService"}).sort({_id: 1}).limit(501)

// nodeDeploy

db.getSiblingDB("jarvis").getCollection("nodeDeploy").find({nodeID:"dff993d6a77ff1e0bf06dee0cfbc4fb1"}).limit(101)

b0d07a9cc6c68c805b00000000000001

// nodeEvent

db.getSiblingDB("jarvis").getCollection("nodeEvent").find({nodeID:"3a30216d457e2b3d59e43065c3c3c6f0"}).sort({createTime:-1}).limit(501)
// 格式化
db.nodeEarn.find().sort({start:-1}).limit(1).forEach(printjson)


db.getSiblingDB("jarvis").getCollection("slaDuration").aggregate([{"$match":{duration:{$gte:10800000000000},start:{"$gte":ISODate("2022-10-10T00:00:00Z"),"$lte":ISODate("2022-10-11T00:00:00Z")}}},{"$group":{_id:"$nodeID",sla_num:{$sum : 1}}}])



db.getSiblingDB("jarvis").getCollection("slaDuration").aggregate([{"$lookup":{from : "nodeStaticInfo",localField: "nodeID",foreignField: "_id",as: "inventory_docs"}},{"$match":{duration:{$gte:10800000000000},start:{"$gte":ISODate("2022-10-10T00:00:00Z"),"$lte":ISODate("2022-10-11T00:00:00Z")},"inventory_docs.stage":"inService"}},{"$group":{_id:"$nodeID",sla_num:{$sum : 1}}},{$count: "totalCount"}])

```
db.getSiblingDB("jarvis").getCollection("slaDuration").find({duration:{$gte:900000000000}}).count

db.getSiblingDB("jarvis").getCollection("slaDuration").aggregate([{"$match":{duration:{$gte:10800000000000},start:{"$gte":ISODate("2022-10-10T00:00:00Z"),"$lte":ISODate("2022-10-11T00:00:00Z")}}},{"$group":{_id:"$nodeID",sla_num:{$sum : 1}}},{$count: "totalCount"}])




db.getSiblingDB("jarvis").getCollection("slaDuration").aggregate([{"$lookup":{from : "nodeStaticInfo",localField: "nodeID",foreignField: "_id",as: "inventory_docs"}},{"$match":{duration:{$gte:10800000000000},start:{"$gte":ISODate("2022-10-10T00:00:00Z"),"$lte":ISODate("2022-10-11T00:00:00Z")},"inventory_docs.stage":"inService"}},{"$group":{_id:"$nodeID",sla_num:{$sum : 1}}},{$count: "totalCount"}])

900000000000  15分钟 267

1800000000000 30分钟 235

3600000000000 60分钟 223

10800000000000 180分钟 200


{ "_id" : "aacfeb860de7406bb9ea79685470be93", "sla_num" : 32 }
{ "_id" : "25ebde1b9d6d95adb700000000000001", "sla_num" : 20 }
{ "_id" : "469351ae5eb0950807b28e82a1d8d66f", "sla_num" : 78 }
{ "_id" : "e4851dd2def1b883e100000000000001", "sla_num" : 20 }
{ "_id" : "7186fa56ecbe0cc50200000000000001", "sla_num" : 17 }
{ "_id" : "b4683a0f4ddf7797668ed49ec322192e", "sla_num" : 1 }
{ "_id" : "8426471e14014aeca7c0c67859283783", "sla_num" : 14 }
{ "_id" : "8fe01c4b0e50a7864d00000000000001", "sla_num" : 13 }
{ "_id" : "5cbd3c9c33a7fc077800000000000001", "sla_num" : 20 }
{ "_id" : "429d2b66e32047f195d095300fbc5655", "sla_num" : 23 }
{ "_id" : "7f10a5b9615e425379353a9b71f71eea", "sla_num" : 62 }
{ "_id" : "a2f09f6bc9dbdd2afa7cebe0d2833bad", "sla_num" : 58 }
{ "_id" : "154af262f215df76e600000000000001", "sla_num" : 11 }
{ "_id" : "79c4ab75937227b9bf00000000000001", "sla_num" : 20 }
{ "_id" : "4e8a25bcc315b4b49600000000000001", "sla_num" : 20 }
{ "_id" : "ac2166f8ee1e0c79389022d865adce4d", "sla_num" : 4 }
{ "_id" : "162789e53074f24105809d40084d88a8", "sla_num" : 10 }
{ "_id" : "dc20cf6964eecebef474c592892df2e4", "sla_num" : 83 }
{ "_id" : "b0efa95f8ae191c90d570aab9b25b5c7", "sla_num" : 1 }
{ "_id" : "dc101a6d5ba9eb5c6800000000000001", "sla_num" : 13 }

1800000000000 30分钟 4196

3600000000000 60分钟 4062

10800000000000 180分钟 3802


eba19b88d4f73f5024590097822c7923






cache:NodeStaticInfo:002a3e275fb274a9795034643548d322

cache:NodeHistory:2c0b4a3c4425c910f9ac48cd4ad929f2




 "peak95" : NumberLong(366560246), "dayPeak95" : { "1662480000" : NumberLong(301863169), "1662566400" : NumberLong(487181686), "1661961600" : NumberLong(405957001), "1662048000" : NumberLong(386769221), "1662134400" : NumberLong(591643814), "1662220800" : NumberLong(570175820), "1662307200" : NumberLong(194091518)



 { "peak95" : NumberLong(687330969), "dayPeak95" : { "1663862400" : NumberLong(800468879), "1664121600" : NumberLong(640584578), "1664380800" : NumberLong(631989726), "1663171200" : NumberLong(514480626), "1663257600" : NumberLong(660069177), "1663516800" : NumberLong(482801049), "1663689600" : NumberLong(516094845), "1662998400" : NumberLong(568600826), "1663084800" : NumberLong(511596802), "1663603200" : NumberLong(488935075), "1664035200" : NumberLong(651759394), "1664294400" : NumberLong(673538119), "1663344000" : NumberLong(650542021), "1663430400" : NumberLong(559128061), "1663776000" : NumberLong(546217796), "1663948800" : NumberLong(804792586), "1662652800" : NumberLong(780590050), "1662739200" : NumberLong(849406562), "1662825600" : NumberLong(835140690), "1662912000" : NumberLong(805935427), "1664208000" : NumberLong(801705619) } } }


 {"nodeID":"zhaofei_8","state":"complete","updateAt":{"$gte":ISODate("2022-08-01T00:00:00+08:00"),ISODate("$lte":"2022-08-31T23:59:59.999999999+08:00")}}

SQL [select "_id", "businessbandwidth", "businessinfo", "curdaypeak95", "date", "daydetails", "end", "finalprice", "iqyslainfo", "lastupdate", "manualadjustprices", "measureinfo", "nodeid", "nominalinfo", "offlinedaycount", "passeddaycountofmonth", "purchasername", "servicetime", "settlebandwidth", "settlebandwidthforcost", "settleprice", "slainfo", "start", "subbusiness", "vendorid", "wastebandwidth", "dw_extract_time", "dt", ("settlebandwidthforcost"-"businessbandwidth") as "结算带宽差异", REGEXP_EXTRACT( REGEXP_REPLACE("nominalinfo",'"','') ,'(?<=city:)[\u4e00-\u9fa5]+',0) as "城市", REGEXP_EXTRACT( REGEXP_REPLACE("nominalinfo",'"','') ,'(?<=province:)[\u4e00-\u9fa5]+',0) as "省", REGEXP_EXTRACT( REGEXP_REPLACE("nominalinfo",'"','') ,'(?<=isp:)[\u4e00-\u9fa5]+',0) as "运营商", REGEXP_EXTRACT( REGEXP_REPLACE("nominalinfo",'"','') ,'(?<=bandwidth:)[0-9]+',0) as "建设带宽", REGEXP_EXTRACT( REGEXP_REPLACE("businessinfo",'"','') ,'(?<=guaranteedRate:)[0-9]+',0) as "保底比例", (REGEXP_EXTRACT( REGEXP_REPLACE("businessinfo",'"','') ,'(?<=guaranteedRate:)[0-9]+',0))*(REGEXP_EXTRACT( REGEXP_REPLACE("businessinfo",'"','') ,'(?<=guaranteedRate:)[0-9]+',0)) as "保底比例为空" from (
select * 
from ods.ods_usr_jarvis_nodeEarn_df 
where dt = (select max(dt) from ods.ods_usr_jarvis_nodeEarn_df )
) as "table_real" limit 1]; Query failed (#20221021_104521_19447_29hfh): line 1:1053: Cannot apply operator: varchar * varchar


SQL [select "_id", "businessbandwidth", "businessinfo", "curdaypeak95", "date", "daydetails", "end", "finalprice", "iqyslainfo", "lastupdate", "manualadjustprices", "measureinfo", "nodeid", "nominalinfo", "offlinedaycount", "passeddaycountofmonth", "purchasername", "servicetime", "settlebandwidth", "settlebandwidthforcost", "settleprice", "slainfo", "start", "subbusiness", "vendorid", "wastebandwidth", "dw_extract_time", "dt", ("settlebandwidthforcost"-"businessbandwidth") as "结算带宽差异", REGEXP_EXTRACT( REGEXP_REPLACE("nominalinfo",'"','') ,'(?<=city:)[\u4e00-\u9fa5]+',0) as "城市", REGEXP_EXTRACT( REGEXP_REPLACE("nominalinfo",'"','') ,'(?<=province:)[\u4e00-\u9fa5]+',0) as "省", REGEXP_EXTRACT( REGEXP_REPLACE("nominalinfo",'"','') ,'(?<=isp:)[\u4e00-\u9fa5]+',0) as "运营商", REGEXP_EXTRACT( REGEXP_REPLACE("nominalinfo",'"','') ,'(?<=bandwidth:)[0-9]+',0) as "建设带宽", REGEXP_EXTRACT( REGEXP_REPLACE("businessinfo",'"','') ,'(?<=guaranteedRate:)[0-9]+',0) as "保底比例", IF(STRPOS((REGEXP_EXTRACT( REGEXP_REPLACE("businessinfo",'"','') ,'(?<=guaranteedRate:)[0-9]+',0)),'null')==0,(REGEXP_EXTRACT( REGEXP_REPLACE("businessinfo",'"','') ,'(?<=guaranteedRate:)[0-9]+',0)),0) as "保底比例为空" from (
select * 
from ods.ods_usr_jarvis_nodeEarn_df 
where dt = (select max(dt) from ods.ods_usr_jarvis_nodeEarn_df )
) as "table_real" limit 1]; Query failed (#20221021_104817_19460_29hfh): line 1:1072: mismatched input 'IF'. Expecting: '*', <expression>

SQL [select "_id", "businessbandwidth", "businessinfo", "curdaypeak95", "date", "daydetails", "end", "finalprice", "iqyslainfo", "lastupdate", "manualadjustprices", "measureinfo", "nodeid", "nominalinfo", "offlinedaycount", "passeddaycountofmonth", "purchasername", "servicetime", "settlebandwidth", "settlebandwidthforcost", "settleprice", "slainfo", "start", "subbusiness", "vendorid", "wastebandwidth", "dw_extract_time", "dt", ("settlebandwidthforcost"-"businessbandwidth") as "结算带宽差异", REGEXP_EXTRACT( REGEXP_REPLACE("nominalinfo",'"','') ,'(?<=city:)[\u4e00-\u9fa5]+',0) as "城市", REGEXP_EXTRACT( REGEXP_REPLACE("nominalinfo",'"','') ,'(?<=province:)[\u4e00-\u9fa5]+',0) as "省", REGEXP_EXTRACT( REGEXP_REPLACE("nominalinfo",'"','') ,'(?<=isp:)[\u4e00-\u9fa5]+',0) as "运营商", REGEXP_EXTRACT( REGEXP_REPLACE("nominalinfo",'"','') ,'(?<=bandwidth:)[0-9]+',0) as "建设带宽", REGEXP_EXTRACT( REGEXP_REPLACE("businessinfo",'"','') ,'(?<=guaranteedRate:)[0-9]+',0) as "保底比例", COALESCE((REGEXP_EXTRACT( REGEXP_REPLACE("businessinfo",'"','') ,'(?<=guaranteedRate:)[0-9]+',0)),'',0) as "保底比例为空" from (
select * 
from ods.ods_usr_jarvis_nodeEarn_df 
where dt = (select max(dt) from ods.ods_usr_jarvis_nodeEarn_df )
) as "table_real" limit 1]; Query failed (#20221021_105214_19471_29hfh): line 1:1066: All COALESCE operands must be the same type: varchar

SQL [select "_id", "businessbandwidth", "businessinfo", "curdaypeak95", "date", "daydetails", "end", "finalprice", "iqyslainfo", "lastupdate", "manualadjustprices", "measureinfo", "nodeid", "nominalinfo", "offlinedaycount", "passeddaycountofmonth", "purchasername", "servicetime", "settlebandwidth", "settlebandwidthforcost", "settleprice", "slainfo", "start", "subbusiness", "vendorid", "wastebandwidth", "dw_extract_time", "dt", ("settlebandwidthforcost"-"businessbandwidth") as "结算带宽差异", REGEXP_EXTRACT( REGEXP_REPLACE("nominalinfo",'"','') ,'(?<=city:)[\u4e00-\u9fa5]+',0) as "城市", REGEXP_EXTRACT( REGEXP_REPLACE("nominalinfo",'"','') ,'(?<=province:)[\u4e00-\u9fa5]+',0) as "省", REGEXP_EXTRACT( REGEXP_REPLACE("nominalinfo",'"','') ,'(?<=isp:)[\u4e00-\u9fa5]+',0) as "运营商", REGEXP_EXTRACT( REGEXP_REPLACE("nominalinfo",'"','') ,'(?<=bandwidth:)[0-9]+',0) as "建设带宽", REGEXP_EXTRACT( REGEXP_REPLACE("businessinfo",'"','') ,'(?<=guaranteedRate:)[0-9]+',0) as "保底比例", ((REGEXP_EXTRACT( REGEXP_REPLACE("businessinfo",'"','') ,'(?<=guaranteedRate:)[0-9]+',0))==null) as "保底比例是否为空" from (
select * 
from ods.ods_usr_jarvis_nodeEarn_df 
where dt = (select max(dt) from ods.ods_usr_jarvis_nodeEarn_df )
) as "table_real" limit 1]; Query failed (#20221021_105848_19529_29hfh): line 1:1055: mismatched input '='. Expecting: ')', ',', '.', '['


SQL [select "_id", "businessbandwidth", "businessinfo", "curdaypeak95", "date", "daydetails", "end", "finalprice", "iqyslainfo", "lastupdate", "manualadjustprices", "measureinfo", "nodeid", "nominalinfo", "offlinedaycount", "passeddaycountofmonth", "purchasername", "servicetime", "settlebandwidth", "settlebandwidthforcost", "settleprice", "slainfo", "start", "subbusiness", "vendorid", "wastebandwidth", "dw_extract_time", "dt", ("settlebandwidthforcost"-"businessbandwidth") as "结算带宽差异", REGEXP_EXTRACT( REGEXP_REPLACE("nominalinfo",'"','') ,'(?<=city:)[\u4e00-\u9fa5]+',0) as "城市", REGEXP_EXTRACT( REGEXP_REPLACE("nominalinfo",'"','') ,'(?<=province:)[\u4e00-\u9fa5]+',0) as "省", REGEXP_EXTRACT( REGEXP_REPLACE("nominalinfo",'"','') ,'(?<=isp:)[\u4e00-\u9fa5]+',0) as "运营商", REGEXP_EXTRACT( REGEXP_REPLACE("nominalinfo",'"','') ,'(?<=bandwidth:)[0-9]+',0) as "建设带宽", REGEXP_EXTRACT( REGEXP_REPLACE("businessinfo",'"','') ,'(?<=guaranteedRate:)[0-9]+',0) as "保底比例", NVL(((REGEXP_EXTRACT( REGEXP_REPLACE("businessinfo",'"','') ,'(?<=guaranteedRate:)[0-9]+',0)),0) as "保底比例是否为空" from (
select * 
from ods.ods_usr_jarvis_nodeEarn_df 
where dt = (select max(dt) from ods.ods_usr_jarvis_nodeEarn_df )
) as "table_real" limit 1]; Query failed (#20221021_105908_19530_29hfh): line 1:1055: mismatched input '='. Expecting: ')', ',', '.', '['



SQL [select "_id", "businessbandwidth", "businessinfo", "curdaypeak95", "date", "daydetails", "end", "finalprice", "iqyslainfo", "lastupdate", "manualadjustprices", "measureinfo", "nodeid", "nominalinfo", "offlinedaycount", "passeddaycountofmonth", "purchasername", "servicetime", "settlebandwidth", "settlebandwidthforcost", "settleprice", "slainfo", "start", "subbusiness", "vendorid", "wastebandwidth", "dw_extract_time", "dt", ("settlebandwidthforcost"-"businessbandwidth") as "结算带宽差异", REGEXP_EXTRACT( REGEXP_REPLACE("nominalinfo",'"','') ,'(?<=city:)[\u4e00-\u9fa5]+',0) as "城市", REGEXP_EXTRACT( REGEXP_REPLACE("nominalinfo",'"','') ,'(?<=province:)[\u4e00-\u9fa5]+',0) as "省", REGEXP_EXTRACT( REGEXP_REPLACE("nominalinfo",'"','') ,'(?<=isp:)[\u4e00-\u9fa5]+',0) as "运营商", REGEXP_EXTRACT( REGEXP_REPLACE("nominalinfo",'"','') ,'(?<=bandwidth:)[0-9]+',0) as "建设带宽", REGEXP_EXTRACT( REGEXP_REPLACE("businessinfo",'"','') ,'(?<=guaranteedRate:)[0-9]+',0) as "保底比例", select "_id", "businessbandwidth", "businessinfo", "curdaypeak95", "date", "daydetails", "end", "finalprice", "iqyslainfo", "lastupdate", "manualadjustprices", "measureinfo", "nodeid", "nominalinfo", "offlinedaycount", "passeddaycountofmonth", "purchasername", "servicetime", "settlebandwidth", "settlebandwidthforcost", "settleprice", "slainfo", "start", "subbusiness", "vendorid", "wastebandwidth", "dw_extract_time", "dt", ("settlebandwidthforcost"-"businessbandwidth") as "结算带宽差异", REGEXP_EXTRACT( REGEXP_REPLACE("nominalinfo",'"','') ,'(?<=city:)[\u4e00-\u9fa5]+',0) as "城市", REGEXP_EXTRACT( REGEXP_REPLACE("nominalinfo",'"','') ,'(?<=province:)[\u4e00-\u9fa5]+',0) as "省", REGEXP_EXTRACT( REGEXP_REPLACE("nominalinfo",'"','') ,'(?<=isp:)[\u4e00-\u9fa5]+',0) as "运营商", REGEXP_EXTRACT( REGEXP_REPLACE("nominalinfo",'"','') ,'(?<=bandwidth:)[0-9]+',0) as "建设带宽", REGEXP_EXTRACT( REGEXP_REPLACE("businessinfo",'"','') ,'(?<=guaranteedRate:)[0-9]+',0) as "保底比例", NVL(((REGEXP_EXTRACT( REGEXP_REPLACE("businessinfo",'"','') ,'(?<=guaranteedRate:)[0-9]+',0)),0) as "保底比例是否为空" from (
select * 
from ods.ods_usr_jarvis_nodeEarn_df 
where dt = (select max(dt) from ods.ods_usr_jarvis_nodeEarn_df )
) as "table_real" limit 1 as "保底比例是否为空" from (
select * 
from ods.ods_usr_jarvis_nodeEarn_df 
where dt = (select max(dt) from ods.ods_usr_jarvis_nodeEarn_df )
) as "table_real" limit 1]; Query failed (#20221021_110334_19537_29hfh): line 1:965: mismatched input 'select'. Expecting: '*', <expression>


SQL [select "_id", "businessbandwidth", "businessinfo", "curdaypeak95", "date", "daydetails", "end", "finalprice", "iqyslainfo", "lastupdate", "manualadjustprices", "measureinfo", "nodeid", "nominalinfo", "offlinedaycount", "passeddaycountofmonth", "purchasername", "servicetime", "settlebandwidth", "settlebandwidthforcost", "settleprice", "slainfo", "start", "subbusiness", "vendorid", "wastebandwidth", "dw_extract_time", "dt", ("settlebandwidthforcost"-"businessbandwidth") as "结算带宽差异", REGEXP_EXTRACT( REGEXP_REPLACE("nominalinfo",'"','') ,'(?<=city:)[\u4e00-\u9fa5]+',0) as "城市", REGEXP_EXTRACT( REGEXP_REPLACE("nominalinfo",'"','') ,'(?<=province:)[\u4e00-\u9fa5]+',0) as "省", REGEXP_EXTRACT( REGEXP_REPLACE("nominalinfo",'"','') ,'(?<=isp:)[\u4e00-\u9fa5]+',0) as "运营商", REGEXP_EXTRACT( REGEXP_REPLACE("nominalinfo",'"','') ,'(?<=bandwidth:)[0-9]+',0) as "建设带宽", REGEXP_EXTRACT( REGEXP_REPLACE("businessinfo",'"','') ,'(?<=guaranteedRate:)[0-9]+',0) as "保底比例", CASE WHEN (REGEXP_EXTRACT( REGEXP_REPLACE("businessinfo",'"','') ,'(?<=guaranteedRate:)[0-9]+',0))=='null' THEN 0
CASE WHEN (REGEXP_EXTRACT( REGEXP_REPLACE("businessinfo",'"','') ,'(?<=guaranteedRate:)[0-9]+',0))=='100' THEN 0
CASE WHEN (REGEXP_EXTRACT( REGEXP_REPLACE("businessinfo",'"','') ,'(?<=guaranteedRate:)[0-9]+',0))=='90' THEN 0
CASE WHEN (REGEXP_EXTRACT( REGEXP_REPLACE("businessinfo",'"','') ,'(?<=guaranteedRate:)[0-9]+',0))=='80' THEN 0
CASE WHEN (REGEXP_EXTRACT( REGEXP_REPLACE("businessinfo",'"','') ,'(?<=guaranteedRate:)[0-9]+',0))=='70' THEN 0
CASE WHEN (REGEXP_EXTRACT( REGEXP_REPLACE("businessinfo",'"','') ,'(?<=guaranteedRate:)[0-9]+',0))=='60' THEN 0
CASE WHEN (REGEXP_EXTRACT( REGEXP_REPLACE("businessinfo",'"','') ,'(?<=guaranteedRate:)[0-9]+',0))=='50' THEN 0
CASE WHEN (REGEXP_EXTRACT( REGEXP_REPLACE("businessinfo",'"','') ,'(?<=guaranteedRate:)[0-9]+',0))=='40' THEN 0
CASE WHEN (REGEXP_EXTRACT( REGEXP_REPLACE("businessinfo",'"','') ,'(?<=guaranteedRate:)[0-9]+',0))=='30' THEN 0
CASE WHEN (REGEXP_EXTRACT( REGEXP_REPLACE("businessinfo",'"','') ,'(?<=guaranteedRate:)[0-9]+',0))=='20' THEN 0
CASE WHEN (REGEXP_EXTRACT( REGEXP_REPLACE("businessinfo",'"','') ,'(?<=guaranteedRate:)[0-9]+',0))=='10' THEN 0
ELSE 0
END as "保底比例数值" from (
select * 
from ods.ods_usr_jarvis_nodeEarn_df 
where dt = (select max(dt) from ods.ods_usr_jarvis_nodeEarn_df )
) as "table_real" limit 1]; Query failed (#20221021_112838_19568_29hfh): line 1:1064: mismatched input '='. Expecting: '.', 'THEN', '['

SQL [select "_id", "businessbandwidth", "businessinfo", "curdaypeak95", "date", "daydetails", "end", "finalprice", "iqyslainfo", "lastupdate", "manualadjustprices", "measureinfo", "nodeid", "nominalinfo", "offlinedaycount", "passeddaycountofmonth", "purchasername", "servicetime", "settlebandwidth", "settlebandwidthforcost", "settleprice", "slainfo", "start", "subbusiness", "vendorid", "wastebandwidth", "dw_extract_time", "dt", ("settlebandwidthforcost"-"businessbandwidth") as "结算带宽差异", REGEXP_EXTRACT( REGEXP_REPLACE("nominalinfo",'"','') ,'(?<=city:)[\u4e00-\u9fa5]+',0) as "城市", REGEXP_EXTRACT( REGEXP_REPLACE("nominalinfo",'"','') ,'(?<=province:)[\u4e00-\u9fa5]+',0) as "省", REGEXP_EXTRACT( REGEXP_REPLACE("nominalinfo",'"','') ,'(?<=isp:)[\u4e00-\u9fa5]+',0) as "运营商", REGEXP_EXTRACT( REGEXP_REPLACE("nominalinfo",'"','') ,'(?<=bandwidth:)[0-9]+',0) as "建设带宽", REGEXP_EXTRACT( REGEXP_REPLACE("businessinfo",'"','') ,'(?<=guaranteedRate:)[0-9]+',0) as "保底比例", CASE WHEN (REGEXP_EXTRACT( REGEXP_REPLACE("businessinfo",'"','') ,'(?<=guaranteedRate:)[0-9]+',0))='null' THEN 0
CASE WHEN (REGEXP_EXTRACT( REGEXP_REPLACE("businessinfo",'"','') ,'(?<=guaranteedRate:)[0-9]+',0))='100' THEN 0
CASE WHEN (REGEXP_EXTRACT( REGEXP_REPLACE("businessinfo",'"','') ,'(?<=guaranteedRate:)[0-9]+',0))='90' THEN 0
CASE WHEN (REGEXP_EXTRACT( REGEXP_REPLACE("businessinfo",'"','') ,'(?<=guaranteedRate:)[0-9]+',0))='80' THEN 0
CASE WHEN (REGEXP_EXTRACT( REGEXP_REPLACE("businessinfo",'"','') ,'(?<=guaranteedRate:)[0-9]+',0))='70' THEN 0
CASE WHEN (REGEXP_EXTRACT( REGEXP_REPLACE("businessinfo",'"','') ,'(?<=guaranteedRate:)[0-9]+',0))='60' THEN 0
CASE WHEN (REGEXP_EXTRACT( REGEXP_REPLACE("businessinfo",'"','') ,'(?<=guaranteedRate:)[0-9]+',0))='50' THEN 0
CASE WHEN (REGEXP_EXTRACT( REGEXP_REPLACE("businessinfo",'"','') ,'(?<=guaranteedRate:)[0-9]+',0))='40' THEN 0
CASE WHEN (REGEXP_EXTRACT( REGEXP_REPLACE("businessinfo",'"','') ,'(?<=guaranteedRate:)[0-9]+',0))='30' THEN 0
CASE WHEN (REGEXP_EXTRACT( REGEXP_REPLACE("businessinfo",'"','') ,'(?<=guaranteedRate:)[0-9]+',0))='20' THEN 0
CASE WHEN (REGEXP_EXTRACT( REGEXP_REPLACE("businessinfo",'"','') ,'(?<=guaranteedRate:)[0-9]+',0))='10' THEN 0
ELSE 0
END as "保底比例数值" from (
select * 
from ods.ods_usr_jarvis_nodeEarn_df 
where dt = (select max(dt) from ods.ods_usr_jarvis_nodeEarn_df )
) as "table_real" limit 1]; Query failed (#20221021_112915_19569_29hfh): line 2:1: mismatched input 'CASE'. Expecting: 'ELSE', 'END', 'WHEN'


{"nodeID" : "e7de459324cbe1d86fa59080c19a7a14", "event" : "outline", "createTime" : ISODate("2022-10-21T23:54:45.121Z") }

"nodeID" : "e7de459324cbe1d86fa59080c19a7a14", "event" : "online", "createTime" : ISODate("2022-10-21T22:56:53.097Z") }
 "nodeID" : "e7de459324cbe1d86fa59080c19a7a14", "event" : "outline", "createTime" : ISODate("2022-10-21T22:56:19.704Z") }
"nodeID" : "e7de459324cbe1d86fa59080c19a7a14", "event" : "online", "createTime" : ISODate("2022-10-21T17:45:14.306Z") }
 "nodeID" : "e7de459324cbe1d86fa59080c19a7a14", "event" : "outline", "createTime" : ISODate("2022-10-21T17:09:35.505Z") }




 outline:   10-22 07:54:45
 online:    10-22 06:56:53
 outline:    10-22 06:56:19
 online:   10-22 01:45:14
 outline: 10-22 01:09:35
